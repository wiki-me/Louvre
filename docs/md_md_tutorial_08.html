<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Louvre: Chapter 8: Pointer Events</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Louvre
   &#160;<span id="projectnumber">v1.2.1-2</span>
   </div>
   <div id="projectbrief">C++ library for Wayland compositors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Chapter 8: Pointer Events </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this chapter, we will delve into the intricacies of managing pointer events, which encompass actions from a mouse or touchpad, including button clicks, movement, and scrolling. All pointer events can be effectively managed through the <a class="el" href="class_louvre_1_1_l_pointer.html" title="Class for handling events generated by pointing devices.">Louvre::LPointer</a> class. This class serves as an interface utilized by the input backend, which, in turn, triggers numerous of its virtual methods.</p>
<p>Furthermore, this class allows you to reroute these events to client surfaces, offering a flexible and controlled event-handling mechanism.</p>
<h2><a class="anchor" id="autotoc_md223"></a>
Security</h2>
<p>As you may already be aware, Wayland presents a significant advancement in security compared to X11, particularly concerning input events. This is due to the fact that in Wayland, the compositor is the exclusive process with direct access to system input events (unless your system is configured in an unsafe way). Consequently, it can selectively and securely transmit these events to clients, thus thwarting potential security vulnerabilities. This approach effectively safeguards against threats like information theft, which could be exploited by malware keyloggers, providing a more robust security framework.</p>
<h2><a class="anchor" id="autotoc_md224"></a>
Sending Events to Clients</h2>
<p>In <a class="el" href="namespace_louvre.html" title="Namespaces.">Louvre</a>, pointer events can be directed to a single client surface at a time. To achieve this, you must initially set the pointer's focus to a specific surface using one of the variants of <a class="el" href="class_louvre_1_1_l_pointer.html#a3298270ab7b52ec400ce6ab1c94f975e" title="Set the pointer focus to a specific surface.">Louvre::LPointer::setFocus()</a>. Once the focus is established, you can then use any of the other event-sending methods, such as <a class="el" href="class_louvre_1_1_l_pointer.html#a1e089ebbc9639f94c2635b5f5c51ad39" title="Send a pointer move event to the surface with focus.">Louvre::LPointer::sendMoveEvent()</a>, <a class="el" href="class_louvre_1_1_l_pointer.html#a5d3cb8e5e0397c8607f24ccb583cacf5" title="Send a pointer button event to the surface with focus.">Louvre::LPointer::sendButtonEvent()</a>, or <a class="el" href="class_louvre_1_1_l_pointer.html#a58c8b50bfb9a2ff4029ca85551f64b9a" title="Send a scroll event to the focused surface.">Louvre::LPointer::sendAxisEvent()</a>. These methods will automatically redirect the events to the currently focused surface.</p>
<p>If you subsequently call <a class="el" href="class_louvre_1_1_l_pointer.html#a3298270ab7b52ec400ce6ab1c94f975e" title="Set the pointer focus to a specific surface.">Louvre::LPointer::setFocus()</a> again, pointing to a different surface, the previous surface will automatically lose focus. To remove focus from all surfaces, you can pass <code>nullptr</code>. Additionally, when a client destroys a surface that currently holds the pointer's focus, the focus is automatically unset as well. You can ascertain which surface currently has pointer focus with <a class="el" href="class_louvre_1_1_l_pointer.html#aaac25564345780ba0fd1dc85a9413efd" title="Get the surface with pointer focus.">Louvre::LPointer::focus()</a>, which may return <code>nullptr</code> if no surface currently holds it.</p>
<p>Without further delay, let's proceed to override the default way that <a class="el" href="namespace_louvre.html" title="Namespaces.">Louvre</a> handles pointer events. To achieve this, we'll create a subclass of <a class="el" href="class_louvre_1_1_l_pointer.html" title="Class for handling events generated by pointing devices.">Louvre::LPointer</a> named <code>EPointer</code>:</p>
<h3><a class="anchor" id="autotoc_md225"></a>
src/EPointer.h</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#ifndef EPOINTER_H</span></div>
<div class="line"><span class="preprocessor">#define EPOINTER_H</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;LPointer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_louvre.html">Louvre</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>EPointer : <span class="keyword">public</span> LPointer</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    EPointer(<span class="keyword">const</span> <span class="keywordtype">void</span> *params);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> pointerMoveEvent(<a class="code" href="namespace_louvre.html#a87d38f886e617ced2698fc55afa07637">Float32</a> x, <a class="code" href="namespace_louvre.html#a87d38f886e617ced2698fc55afa07637">Float32</a> y, <span class="keywordtype">bool</span> isAbsolute) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> pointerButtonEvent(Button button, ButtonState state) <span class="keyword">override</span>;</div>
<div class="line">    <span class="keywordtype">void</span> pointerAxisEvent(<a class="code" href="namespace_louvre.html#a3f1431cb9f76da10f59246d1d743dc2c">Float64</a> axisX, <a class="code" href="namespace_louvre.html#a3f1431cb9f76da10f59246d1d743dc2c">Float64</a> axisY, <a class="code" href="namespace_louvre.html#a20b0c262d9ef5d263888e463dfa99638">Int32</a> discreteX, <a class="code" href="namespace_louvre.html#a20b0c262d9ef5d263888e463dfa99638">Int32</a> discreteY, AxisSource source) <span class="keyword">override</span>;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// EPOINTER_H</span></div>
<div class="ttc" id="anamespace_louvre_html"><div class="ttname"><a href="namespace_louvre.html">Louvre</a></div><div class="ttdoc">Namespaces.</div></div>
<div class="ttc" id="anamespace_louvre_html_a20b0c262d9ef5d263888e463dfa99638"><div class="ttname"><a href="namespace_louvre.html#a20b0c262d9ef5d263888e463dfa99638">Louvre::Int32</a></div><div class="ttdeci">int32_t Int32</div><div class="ttdoc">32 bits signed integer</div><div class="ttdef"><b>Definition:</b> LNamespaces.h:210</div></div>
<div class="ttc" id="anamespace_louvre_html_a3f1431cb9f76da10f59246d1d743dc2c"><div class="ttname"><a href="namespace_louvre.html#a3f1431cb9f76da10f59246d1d743dc2c">Louvre::Float64</a></div><div class="ttdeci">double Float64</div><div class="ttdoc">64 bits float</div><div class="ttdef"><b>Definition:</b> LNamespaces.h:231</div></div>
<div class="ttc" id="anamespace_louvre_html_a87d38f886e617ced2698fc55afa07637"><div class="ttname"><a href="namespace_louvre.html#a87d38f886e617ced2698fc55afa07637">Louvre::Float32</a></div><div class="ttdeci">float Float32</div><div class="ttdoc">32 bits float</div><div class="ttdef"><b>Definition:</b> LNamespaces.h:234</div></div>
</div><!-- fragment --><p>Here, we're overriding all input event methods of <a class="el" href="class_louvre_1_1_l_pointer.html" title="Class for handling events generated by pointing devices.">Louvre::LPointer</a>, each serving a distinct purpose:</p>
<ul>
<li><a class="el" href="class_louvre_1_1_l_pointer.html#a77b9e66ab7c35df84438822d23097c56" title="Pointer move event.">Louvre::LPointer::pointerMoveEvent</a>: Notifies us of absolute or relative pointer movement.</li>
<li><a class="el" href="class_louvre_1_1_l_pointer.html#ae708706b1d8f1d607aa1cb71f905cbba" title="Pointer button event.">Louvre::LPointer::pointerButtonEvent</a>: Informs us when a mouse or touchpad button is pressed or released. The <a class="el" href="class_louvre_1_1_l_pointer.html#a087a8e5ed9020d23925a0570ad4121ab" title="Pointer buttons.">Louvre::LPointer::Button</a> argument specifies which button, and <a class="el" href="class_louvre_1_1_l_pointer.html#a607874491df5fbafef7ea050db74a5d7" title="Pointer button states.">Louvre::LPointer::ButtonState</a> indicates the state (pressed or released).</li>
<li><a class="el" href="class_louvre_1_1_l_pointer.html#af0868cdd30f02ec969fdd93e6a48aeec" title="Pointer scroll event.">Louvre::LPointer::pointerAxisEvent</a>: Reports scrolling events, which can involve continuous or discrete axis components depending on the source. For example, two-finger scrolling employs continuous axis components, while a mouse scroll wheel uses discrete ones.</li>
</ul>
<h3><a class="anchor" id="autotoc_md226"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;LCursor.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LDNDManager.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LSeat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LOutput.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LSurface.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LDNDIconRole.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LToplevelRole.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LKeyboard.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LCompositor.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;EPointer.h&quot;</span></div>
<div class="line"> </div>
<div class="line">EPointer::EPointer(<span class="keyword">const</span> <span class="keywordtype">void</span> *params) : LPointer(params) {}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> EPointer::pointerMoveEvent(Float32 x, Float32 y, <span class="keywordtype">bool</span> isAbsolute)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (isAbsolute)</div>
<div class="line">        cursor()-&gt;setPos(x, y);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        cursor()-&gt;move(x, y);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Repaint outputs that intersect with the cursor if hardware composition is not supported.</span></div>
<div class="line">    cursor()-&gt;repaintOutputs(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update the drag &amp; drop icon position</span></div>
<div class="line">    <span class="keywordflow">if</span> (seat()-&gt;dndManager()-&gt;icon())</div>
<div class="line">    {</div>
<div class="line">        seat()-&gt;dndManager()-&gt;icon()-&gt;surface()-&gt;setPos(cursor()-&gt;pos());</div>
<div class="line">        seat()-&gt;dndManager()-&gt;icon()-&gt;surface()-&gt;repaintOutputs();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (resizingToplevel())</div>
<div class="line">    {</div>
<div class="line">        updateResizingToplevelSize(cursor()-&gt;pos());</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (movingToplevel())</div>
<div class="line">    {</div>
<div class="line">        updateMovingToplevelPos(cursor()-&gt;pos());</div>
<div class="line"> </div>
<div class="line">        movingToplevel()-&gt;surface()-&gt;repaintOutputs();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (movingToplevel()-&gt;maximized())</div>
<div class="line">            movingToplevel()-&gt;configure(movingToplevel()-&gt;pendingStates() &amp;~ LToplevelRole::Maximized);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// If we are in a drag &amp; drop session, we call setDraggingSurface(nullptr)</span></div>
<div class="line">    <span class="comment">// to prevent the current surface from retaining focus.</span></div>
<div class="line">    <span class="keywordflow">if</span> (seat()-&gt;dndManager()-&gt;dragging())</div>
<div class="line">        setDraggingSurface(<span class="keyword">nullptr</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// If a surface had the left pointer button held down</span></div>
<div class="line">    <span class="keywordflow">if</span> (draggingSurface())</div>
<div class="line">    {</div>
<div class="line">        sendMoveEvent();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Find the first surface under the cursor</span></div>
<div class="line">    LSurface *surface { surfaceAt(cursor()-&gt;pos()) };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (surface)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (focus() == surface)</div>
<div class="line">            sendMoveEvent();</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            setFocus(surface);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        setFocus(<span class="keyword">nullptr</span>);</div>
<div class="line">        cursor()-&gt;useDefault();</div>
<div class="line">        cursor()-&gt;setVisible(<span class="keyword">true</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> EPointer::pointerButtonEvent(Button button, ButtonState state)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (state == Released &amp;&amp; button == Left)</div>
<div class="line">        seat()-&gt;dndManager()-&gt;drop();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!focus())</div>
<div class="line">    {</div>
<div class="line">        LSurface *surface { surfaceAt(cursor()-&gt;pos()) };</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (surface)</div>
<div class="line">        {</div>
<div class="line">            seat()-&gt;keyboard()-&gt;setFocus(surface);</div>
<div class="line">            setFocus(surface);</div>
<div class="line">            sendButtonEvent(button, state);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!surface-&gt;popup())</div>
<div class="line">                dismissPopups();</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            seat()-&gt;keyboard()-&gt;setFocus(<span class="keyword">nullptr</span>);</div>
<div class="line">            dismissPopups();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    sendButtonEvent(button, state);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (button != Left)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Left button pressed</span></div>
<div class="line">    <span class="keywordflow">if</span> (state == Pressed)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We save the pointer focus surface to continue sending events to it even when the cursor</span></div>
<div class="line">        <span class="comment">// is outside of it (while the left button is being held down)</span></div>
<div class="line">        setDraggingSurface(focus());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!seat()-&gt;keyboard()-&gt;focus() || !focus()-&gt;isSubchildOf(seat()-&gt;keyboard()-&gt;focus()))</div>
<div class="line">            seat()-&gt;keyboard()-&gt;setFocus(focus());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (focus()-&gt;toplevel() &amp;&amp; !focus()-&gt;toplevel()-&gt;activated())</div>
<div class="line">            focus()-&gt;toplevel()-&gt;configure(focus()-&gt;toplevel()-&gt;pendingStates() | LToplevelRole::Activated);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!focus()-&gt;popup())</div>
<div class="line">            dismissPopups();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (focus() == compositor()-&gt;surfaces().back())</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (focus()-&gt;parent())</div>
<div class="line">            focus()-&gt;topmostParent()-&gt;raise();</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            focus()-&gt;raise();</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// Left button released</span></div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        stopResizingToplevel();</div>
<div class="line">        stopMovingToplevel();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We stop sending events to the surface on which the left button was being held down</span></div>
<div class="line">        setDraggingSurface(<span class="keyword">nullptr</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!focus()-&gt;inputRegion().containsPoint(cursor()-&gt;pos() - focus()-&gt;rolePos()))</div>
<div class="line">        {</div>
<div class="line">            setFocus(<span class="keyword">nullptr</span>);</div>
<div class="line">            cursor()-&gt;useDefault();</div>
<div class="line">            cursor()-&gt;setVisible(<span class="keyword">true</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> EPointer::pointerAxisEvent(Float64 axisX, Float64 axisY, Int32 discreteX, Int32 discreteY, AxisSource source)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Invert the scroll axis for natural scrolling</span></div>
<div class="line">    sendAxisEvent(-axisX, -axisY, -discreteX, -discreteY, source);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Stay calm! Here, we are currently using the default implementation provided by <a class="el" href="namespace_louvre.html" title="Namespaces.">Louvre</a>. I'll explain what is happening shortly. But first, let's proceed to override the <a class="el" href="class_louvre_1_1_l_pointer.html" title="Class for handling events generated by pointing devices.">Louvre::LPointer</a> virtual constructor (<a class="el" href="class_louvre_1_1_l_compositor.html#a56d929efde5eb74df96591c5d10d0bcb" title="Virtual constructor for creating the LPointer instance during LSeat initialization.">Louvre::LCompositor::createPointerRequest()</a>).</p>
<h3><a class="anchor" id="autotoc_md227"></a>
src/ECompositor.h</h3>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Virtual constructors</span></div>
<div class="line">LOutput *createOutputRequest(<span class="keyword">const</span> <span class="keywordtype">void</span> *params) <span class="keyword">override</span>;</div>
<div class="line">LSurface *createSurfaceRequest(<span class="keyword">const</span> <span class="keywordtype">void</span> *params) <span class="keyword">override</span>;</div>
<div class="line">LPointer *createPointerRequest(<span class="keyword">const</span> <span class="keywordtype">void</span> *params) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md228"></a>
src/ECompositor.cpp</h3>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;EPointer.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">LPointer *ECompositor::createPointerRequest(<span class="keyword">const</span> <span class="keywordtype">void</span> *params)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="keyword">new</span> EPointer(params);</div>
<div class="line">}</div>
</div><!-- fragment --><p>If you recompile and run the compositor, you won't observe any changes because we've implemented the same logic that <a class="el" href="namespace_louvre.html" title="Namespaces.">Louvre</a> uses by default to handle each <a class="el" href="class_louvre_1_1_l_pointer.html" title="Class for handling events generated by pointing devices.">Louvre::LPointer</a> event.</p>
<p>Now, let's delve deeper into what each method is accomplishing:</p>
<h3><a class="anchor" id="autotoc_md229"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> EPointer::pointerMoveEvent(Float32 x, Float32 y, <span class="keywordtype">bool</span> isAbsolute)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (isAbsolute)</div>
<div class="line">        cursor()-&gt;setPos(x, y);</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        cursor()-&gt;move(x, y);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Repaint outputs that intersect with the cursor if hardware composition is not supported.</span></div>
<div class="line">    cursor()-&gt;repaintOutputs(<span class="keyword">true</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update the drag &amp; drop icon position</span></div>
<div class="line">    <span class="keywordflow">if</span> (seat()-&gt;dndManager()-&gt;icon())</div>
<div class="line">    {</div>
<div class="line">        seat()-&gt;dndManager()-&gt;icon()-&gt;surface()-&gt;setPos(cursor()-&gt;pos());</div>
<div class="line">        seat()-&gt;dndManager()-&gt;icon()-&gt;surface()-&gt;repaintOutputs();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Here, we first update the cursor position. Following this, we invoke repaint on all outputs where the cursor is visible if hardware cursor composition is not available (check <a class="el" href="class_louvre_1_1_l_cursor.html#aa9b37889163eda43aff587b1ffc03af1" title="Repaint intersected outputs.">Louvre::LCursor::repaintOutputs()</a>). This ensures that the cursor is appropriately repainted using OpenGL.</p>
<p>Additionally, we conduct a check to determine if a drag &amp; drop session is currently in progress. If so, we match the position of the dragged icon with the cursor position, ensuring that it follows the cursor.</p>
<h3><a class="anchor" id="autotoc_md230"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> EPointer::pointerMoveEvent(Float32 x, Float32 y, <span class="keywordtype">bool</span> isAbsolute)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (resizingToplevel())</div>
<div class="line">    {</div>
<div class="line">        updateResizingToplevelSize(cursor()-&gt;pos());</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (movingToplevel())</div>
<div class="line">    {</div>
<div class="line">        updateMovingToplevelPos(cursor()-&gt;pos());</div>
<div class="line"> </div>
<div class="line">        movingToplevel()-&gt;surface()-&gt;repaintOutputs();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (movingToplevel()-&gt;maximized())</div>
<div class="line">            movingToplevel()-&gt;configure(movingToplevel()-&gt;pendingStates() &amp;~ LToplevelRole::Maximized);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// If we are in a drag &amp; drop session, we call setDraggingSurface(nullptr)</span></div>
<div class="line">    <span class="comment">// to prevent the current surface from retaining focus.</span></div>
<div class="line">    <span class="keywordflow">if</span> (seat()-&gt;dndManager()-&gt;dragging())</div>
<div class="line">        setDraggingSurface(<span class="keyword">nullptr</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// If a surface had the left pointer button held down</span></div>
<div class="line">    <span class="keywordflow">if</span> (draggingSurface())</div>
<div class="line">    {</div>
<div class="line">        sendMoveEvent();</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>In this section, we handle interactive resizing or movement of toplevel windows, elaborated further in <a href="md_md_tutorial_10.html">Chapter 10: Toplevels</a>.</p>
<p>We also employ <a class="el" href="class_louvre_1_1_l_pointer.html#a4195079d16a39096102c91c553ab6951" title="Keep track of the surface pressed by the left pointer button.">Louvre::LPointer::setDraggingSurface()</a> and <a class="el" href="class_louvre_1_1_l_pointer.html#a7869b70055454ab08605c9e30f9eef15" title="Surface being actively pressed by the left pointer button.">Louvre::LPointer::draggingSurface()</a> to maintain the focus when the left pointer button is initially pressed within the focused surface and then moved outside. This is done for preserving the surface focus during actions like text selection, preventing annoying focus loss when the cursor moves outside the surface. It's important to note that this is unrelated to drag &amp; drop sessions. If a drag and drop session is active, we unset <a class="el" href="class_louvre_1_1_l_pointer.html#a7869b70055454ab08605c9e30f9eef15" title="Surface being actively pressed by the left pointer button.">Louvre::LPointer::draggingSurface()</a> to ensure that each surface beneath the cursor receives pointer focus.</p>
<p>Furthermore, we use <a class="el" href="class_louvre_1_1_l_pointer.html#a1e089ebbc9639f94c2635b5f5c51ad39" title="Send a pointer move event to the surface with focus.">Louvre::LPointer::sendMoveEvent()</a> to transmit the event to the focused surface. The client anticipates the position to be in local surface coordinates. In this scenario, we opt for the variant of <a class="el" href="class_louvre_1_1_l_pointer.html#a1e089ebbc9639f94c2635b5f5c51ad39" title="Send a pointer move event to the surface with focus.">Louvre::LPointer::sendMoveEvent()</a> that requires no arguments, as it automatically computes the local surface position using <a class="el" href="class_louvre_1_1_l_surface.html#adb14a727889d37b9b51c18a9a54745eb" title="Role position.">Louvre::LSurface::rolePos()</a> and the cursor's position. Alternatively, you have the option to use other variats to manually specify the local surface position.</p>
<h3><a class="anchor" id="autotoc_md231"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> EPointer::pointerMoveEvent(Float32 x, Float32 y, <span class="keywordtype">bool</span> isAbsolute)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Find the first surface under the cursor</span></div>
<div class="line">    LSurface *surface { surfaceAt(cursor()-&gt;pos()) };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (surface)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span> (focus() == surface)</div>
<div class="line">            sendMoveEvent();</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            setFocus(surface);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        setFocus(<span class="keyword">nullptr</span>);</div>
<div class="line">        cursor()-&gt;useDefault();</div>
<div class="line">        cursor()-&gt;setVisible(<span class="keyword">true</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Finally, if this method was not previously returned, we perform the following actions:</p>
<ol type="1">
<li>Recheck which surface is currently under the cursor using <a class="el" href="class_louvre_1_1_l_pointer.html#a9322272283f36214d4d3a692fadea022" title="Look for a surface.">Louvre::LPointer::surfaceAt()</a>. This method returns the first mapped surface beneath the cursor based on the <a class="el" href="class_louvre_1_1_l_surface.html#a8d606d6765c328e4f6b7cb370cea6f50" title="Input region in surface coordinates.">Louvre::LSurface::inputRegion()</a>. It's important to note that certain surfaces, such as <a class="el" href="class_louvre_1_1_l_cursor_role.html" title="Cursor role for surfaces.">Louvre::LCursorRole</a> or <a class="el" href="class_louvre_1_1_l_d_n_d_icon_role.html" title="Drag &amp; drop icon role for surfaces.">Louvre::LDNDIconRole</a>, lack an input region and are therefore never returned by this method. Additionally, it returns <code>nullptr</code> if no surface is found.</li>
<li>If we discover a surface under the cursor, we assign it focus. If the surface is the same as the currently focused one, we send a move event.</li>
<li>If no surface is found under the cursor, we unset pointer focus from all surfaces and restore the default cursor texture. Details on how clients can request changes to cursor texture and visibility will be covered later in <a href="md_md_tutorial_13.html">Chapter 13: Cursor</a>.</li>
</ol>
<p>Now lets move to <a class="el" href="class_louvre_1_1_l_pointer.html#ae708706b1d8f1d607aa1cb71f905cbba" title="Pointer button event.">Louvre::LPointer::pointerButtonEvent()</a>:</p>
<h3><a class="anchor" id="autotoc_md232"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> EPointer::pointerButtonEvent(Button button, ButtonState state)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (state == Released &amp;&amp; button == Left)</div>
<div class="line">        seat()-&gt;dndManager()-&gt;drop();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>First, if the left pointer button is released, we invoke <a class="el" href="class_louvre_1_1_l_d_n_d_manager.html#a2f4c2dc71944a7a7a5a272dfce0e8d43" title="Drop the data offer.">Louvre::LDNDManager::drop()</a>. This action initiates a drop operation if a drag &amp; drop session is in progress. Importantly, calling it when no session is active is a harmless no-op.</p>
<h3><a class="anchor" id="autotoc_md233"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> EPointer::pointerButtonEvent(Button button, ButtonState state)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!focus())</div>
<div class="line">    {</div>
<div class="line">        LSurface *surface { surfaceAt(cursor()-&gt;pos()) };</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (surface)</div>
<div class="line">        {</div>
<div class="line">            seat()-&gt;keyboard()-&gt;setFocus(surface);</div>
<div class="line">            setFocus(surface);</div>
<div class="line">            sendButtonEvent(button, state);</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (!surface-&gt;popup())</div>
<div class="line">                dismissPopups();</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            seat()-&gt;keyboard()-&gt;setFocus(<span class="keyword">nullptr</span>);</div>
<div class="line">            dismissPopups();</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Then, in the absence of a currently focused surface, we search for one using <a class="el" href="class_louvre_1_1_l_pointer.html#a9322272283f36214d4d3a692fadea022" title="Look for a surface.">Louvre::LPointer::surfaceAt()</a> once again.</p>
<p>If a surface is discovered, we assign it both pointer and keyboard focus and transmit the button event. Additionally, if the surface is not a popup, we dismiss them. This is employed to address the issue of certain buggy clients failing to close popups, an undesired behavior.</p>
<p>If no surface is found under the cursor, we remove keyboard focus and once again we dismiss any popups.</p>
<h3><a class="anchor" id="autotoc_md234"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> EPointer::pointerButtonEvent(Button button, ButtonState state)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    sendButtonEvent(button, state);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (button != Left)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Left button pressed</span></div>
<div class="line">    <span class="keywordflow">if</span> (state == Pressed)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// We save the pointer focus surface to continue sending events to it even when the cursor</span></div>
<div class="line">        <span class="comment">// is outside of it (while the left button is being held down)</span></div>
<div class="line">        setDraggingSurface(focus());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!seat()-&gt;keyboard()-&gt;focus() || !focus()-&gt;isSubchildOf(seat()-&gt;keyboard()-&gt;focus()))</div>
<div class="line">            seat()-&gt;keyboard()-&gt;setFocus(focus());</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (focus()-&gt;toplevel() &amp;&amp; !focus()-&gt;toplevel()-&gt;activated())</div>
<div class="line">            focus()-&gt;toplevel()-&gt;configure(focus()-&gt;toplevel()-&gt;pendingStates() | LToplevelRole::Activated);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!focus()-&gt;popup())</div>
<div class="line">            dismissPopups();</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (focus() == compositor()-&gt;surfaces().back())</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (focus()-&gt;parent())</div>
<div class="line">            focus()-&gt;topmostParent()-&gt;raise();</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            focus()-&gt;raise();</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">// Left button released</span></div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">    {</div>
<div class="line">        stopResizingToplevel();</div>
<div class="line">        stopMovingToplevel();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// We stop sending events to the surface on which the left button was being held down</span></div>
<div class="line">        setDraggingSurface(<span class="keyword">nullptr</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (!focus()-&gt;inputRegion().containsPoint(cursor()-&gt;pos() - focus()-&gt;rolePos()))</div>
<div class="line">        {</div>
<div class="line">            setFocus(<span class="keyword">nullptr</span>);</div>
<div class="line">            cursor()-&gt;useDefault();</div>
<div class="line">            cursor()-&gt;setVisible(<span class="keyword">true</span>);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>If a surface has pointer focus, we send the button event. If the button isn't the left one, we return since we mainly use the left button for actions.</p>
<p>When the left button is pressed over a surface:</p><ul>
<li>We set it as the dragging surface, maintaining focus.</li>
<li>Assign keyboard focus.</li>
<li>If it's a toplevel, we make it active, highlighting its decorations.</li>
<li>If not a popup, we dismiss popups.</li>
<li>Finally, we bring it to the front, along with its parent surface, if applicable, stacking it above others.</li>
</ul>
<p>When the left button is released:</p><ul>
<li>We halt interactive toplevel resizing or movement.</li>
<li>Unset the dragging surface.</li>
<li>Check if the cursor is over the surface's input region. If not, we clear pointer focus and restore the cursor to its default state.</li>
</ul>
<p>Well, let's all take a deep breath and shift our focus to the seemingly simpler <a class="el" href="class_louvre_1_1_l_pointer.html#af0868cdd30f02ec969fdd93e6a48aeec" title="Pointer scroll event.">Louvre::LPointer::pointerAxisEvent()</a>.</p>
<h3><a class="anchor" id="autotoc_md235"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> EPointer::pointerAxisEvent(Float64 axisX, Float64 axisY, Int32 discreteX, Int32 discreteY, AxisSource source)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Invert the scroll axis for natural scrolling</span></div>
<div class="line">    sendAxisEvent(-axisX, -axisY, -discreteX, -discreteY, source);</div>
<div class="line">}</div>
</div><!-- fragment --><p>In this section, we're simply routing the scroll event to the surface that currently holds focus.</p>
<p>Additionally, it's worth noting that we've inverted the axis values. This adjustment is made to accommodate natural scrolling. However, feel free to customize it to your preference.</p>
<h1><a class="anchor" id="autotoc_md236"></a>
Managing Pointer Events with LScene</h1>
<p>The detailed breakdown of each event handling was provided solely for educational purposes, enabling you to grasp event management concepts. However, similar to the approach we explored with <a class="el" href="class_louvre_1_1_l_output.html" title="A display rendering interface.">Louvre::LOutput</a>, the <a class="el" href="class_louvre_1_1_l_scene.html" title="The LScene class is an optional utility that significantly simplifies rendering.">Louvre::LScene</a> class also offers methods to handle pointer events in a similar manner.</p>
<p>Using <a class="el" href="class_louvre_1_1_l_scene.html" title="The LScene class is an optional utility that significantly simplifies rendering.">Louvre::LScene</a> presents an additional advantage: it allows you to listent to per-view events. To integrate <a class="el" href="class_louvre_1_1_l_scene.html" title="The LScene class is an optional utility that significantly simplifies rendering.">Louvre::LScene</a> with <a class="el" href="class_louvre_1_1_l_pointer.html" title="Class for handling events generated by pointing devices.">Louvre::LPointer</a>, you simply need to "plug it" like this:</p>
<h3><a class="anchor" id="autotoc_md237"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;LScene.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;EPointer.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Global.h&quot;</span></div>
<div class="line"> </div>
<div class="line">EPointer::EPointer(<span class="keyword">const</span> <span class="keywordtype">void</span> *params) : LPointer(params) {}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> EPointer::pointerMoveEvent(Float32 x, Float32 y, <span class="keywordtype">bool</span> isAbsolute)</div>
<div class="line">{</div>
<div class="line">    G::scene()-&gt;handlePointerMoveEvent(x, y, isAbsolute);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> EPointer::pointerButtonEvent(Button button, ButtonState state)</div>
<div class="line">{</div>
<div class="line">    G::scene()-&gt;handlePointerButtonEvent(button, state);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> EPointer::pointerAxisEvent(Float64 axisX, Float64 axisY, Int32 discreteX, Int32 discreteY, AxisSource source)</div>
<div class="line">{</div>
<div class="line">    G::scene()-&gt;handlePointerAxisEvent(-axisX, -axisY, -discreteX, -discreteY, source);</div>
<div class="line">}</div>
</div><!-- fragment --><p>After recompiling and running the compositor, everything should continue to function as expected, with one minor change. If you happen to move the cursor outside of a surface, you'll notice that the cursor does not revert to its default state.<br  />
To address this issue, we can implement the following solution:</p>
<h3><a class="anchor" id="autotoc_md238"></a>
src/EPointer.cpp</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;LScene.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LCursor.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;LView.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &quot;EPointer.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;Global.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> EPointer::pointerMoveEvent(Float32 x, Float32 y, <span class="keywordtype">bool</span> isAbsolute)</div>
<div class="line">{</div>
<div class="line">    LView *view { G::scene()-&gt;handlePointerMoveEvent(x, y, isAbsolute) };</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((!view || view-&gt;type() != LView::Type::Surface) &amp;&amp; !resizingToplevel() &amp;&amp; !movingToplevel())</div>
<div class="line">    {</div>
<div class="line">        cursor()-&gt;useDefault();</div>
<div class="line">        cursor()-&gt;setVisible(<span class="keyword">true</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
</div><!-- fragment --><p>The <a class="el" href="class_louvre_1_1_l_scene.html#a6d21e99badc0d69f26c2561709f3d091" title="Handle pointer movement event.">Louvre::LScene::handlePointerMoveEvent()</a> method returns the first view located under the cursor or <code>nullptr</code> if no view is found.<br  />
In cases where either no view is found or the identified view is not of type <a class="el" href="class_louvre_1_1_l_surface_view.html" title="View for displaying surfaces.">Louvre::LSurfaceView</a>, we take action to restore the cursor to its default state. Additionally, we avoid restoring the cursor when a toplevel window is currently being resized or moved. This precaution is taken because the client may intend to display a specific cursor, such as a resize edge cursor or a hand-dragging cursor, during these operations.</p>
<h2><a class="anchor" id="autotoc_md239"></a>
Restoring Minimized Surfaces</h2>
<p>By using <a class="el" href="class_louvre_1_1_l_scene.html" title="The LScene class is an optional utility that significantly simplifies rendering.">Louvre::LScene</a> for handling pointer events, we can now detect when the user clicks on the topbar thumbnails. To achieve this, we need to enable input events for each thumbnail view using <a class="el" href="class_louvre_1_1_l_view.html#aeb90db64c9541c78406d03fd0948f1ea" title="Enable or disable pointer and touch events for the view.">Louvre::LView::enableInput()</a>.</p>
<blockquote class="doxtable">
<p>By default, all view types, except for <a class="el" href="class_louvre_1_1_l_surface_view.html" title="View for displaying surfaces.">Louvre::LSurfaceView</a>, have input disabled. This means they are ignored during pointer events handling, enabling views behind them to receive those events instead. </p>
</blockquote>
<p>Additionally, we must override their <a class="el" href="class_louvre_1_1_l_view.html#a42e8d84bbf22b5ec30645151ab79db94" title="Handle the pointer button event within the view.">Louvre::LView::pointerButtonEvent()</a> virtual method:</p>
<h3><a class="anchor" id="autotoc_md240"></a>
src/EThumbnail.h</h3>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>EThumbnail : <span class="keyword">public</span> LTextureView</div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> pointerButtonEvent(LPointer::Button button, LPointer::ButtonState state) <span class="keyword">override</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md241"></a>
src/EThumbnail.cpp</h3>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">EThumbnail::EThumbnail(ETopbar *topbar, ESurface *surface) :</div>
<div class="line">    LTextureView(surface-&gt;thumbnailTexture, &amp;topbar-&gt;view),</div>
<div class="line">    topbar(topbar),</div>
<div class="line">    surface(surface)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">    enableInput(<span class="keyword">true</span>);    </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> EThumbnail::pointerButtonEvent(LPointer::Button button, LPointer::ButtonState state)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (button == LPointer::Button::Left &amp;&amp; state == LPointer::ButtonState::Released)</div>
<div class="line">        surface-&gt;setMinimized(<span class="keyword">false</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now, clicking on a thumbnail view using the left pointer button results in the corresponding surface being unminimized—simple and efficient.</p>
<p>You can also explore other per-view pointer events, such as when the cursor enters or leaves the view, scrolling events, and more. For detailed information, please refer to the documentation of <a class="el" href="class_louvre_1_1_l_view.html" title="Base class for LScene views.">Louvre::LView</a>.</p>
<h2><a class="anchor" id="autotoc_md242"></a>
Disabling Wayland Event Handling</h2>
<p>If you need to handle pointer events differently from how <a class="el" href="class_louvre_1_1_l_scene.html" title="The LScene class is an optional utility that significantly simplifies rendering.">Louvre::LScene</a> does, while still receiving per-view events, you can disable the Wayland event handling of <a class="el" href="class_louvre_1_1_l_scene.html" title="The LScene class is an optional utility that significantly simplifies rendering.">Louvre::LScene</a> using <a class="el" href="class_louvre_1_1_l_scene.html#a7b4c55db8c4e54f3068faf8e6dbbbd30" title="Enable or disable handling of Wayland pointer events.">Louvre::LScene::enableHandleWaylandPointerEvents()</a>. This allows you to continue receiving per-view pointer events while giving you the flexibility to manually send these events to clients, as we demonstrated earlier in this chapter.</p>
<p>In the upcoming chapter, we'll explore the realm of handling keyboard events. Until then, see you there!</p>
<p><a href="md_md_tutorial_07.html">◀ Chapter 7: Surfaces</a> || <a href="md_md_tutorial_09.html">Chapter 9: Keyboard Events ▶</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<script>
    var menu = false;
    var burger, nav;
    function resp()
    {
        if (window.innerWidth < 768)
        {
            burger.hidden = false;
            nav.hidden = true;
        }
        else
        {
            burger.hidden = true;
            nav.hidden = false;
        }
        menu = false;
    }
    function toggleMenu()
    {
        nav.hidden = menu;
        menu = !menu;
    }
    window.onload = function()
    {
        // Get all <a> tags with the "el" class
        var elLinks = document.querySelectorAll('a.el');
        // Loop through the matched elements
        elLinks.forEach(function(link) 
        {
            // Replace "Louvre::" with an empty string in the text content
            link.textContent = link.textContent.replace(/Louvre::/g, '');
        });
        nav = document.getElementById('main-nav');
        burger = document.createElement('div');
        burger.style.position = 'absolute';
        burger.style.top = '14px';
        burger.style.right = burger.style.top;
        burger.innerHTML = '<svg onclick="toggleMenu()" height="32px" viewBox="0 0 448 512"><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg>';
        document.getElementById('top').appendChild(burger);
        resp();
    };
    window.onresize = function()
    {
        resp();
    };
</script>
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">Project developed by <a href="https://github.com/CuarzoSoftware"><img class="footer" src="https://avatars.githubusercontent.com/u/29326763?s=200&v=4" style="margin-left:2px;position:relative;top:-1px;width:12px;height:12px" alt="cuarzo"/> Cuarzo Software</a></li>
    </ul>
</div>